var DEBUG,GAME_HEIGHT,GRAVITY,GROUND_HEIGHT,GROUND_Y,HARD,HEIGHT,SPAWN_RATE,SPEED,WIDTH,avoidText,bestScore,bestText,bg,smashroom,mashrooms,mushrooms,mashroomsTimer,blood,bloods,board,dieRate,fallSnd,flapSnd,floor,gameOver,gameOverText,gameStart,gameStartText,ground,hurtSnd,instText,main,resetText,score,scoreSnd,scoreText,swooshSnd,mario;DEBUG=!1;SPEED=160;GRAVITY=600;SPAWN_RATE=1/1200;HEIGHT=480;WIDTH=320;GAME_HEIGHT=336;GROUND_HEIGHT=64;GROUND_Y=HEIGHT-GROUND_HEIGHT;HARD=250;
bloods=blood=bg=ground=smashroom=mushrooms=mashrooms=mario=null;gameOver=gameStart=!1;score=dieRate=mashroomsTimer=null;bestScore=0;swooshSnd=fallSnd=hurtSnd=scoreSnd=flapSnd=board=avoidText=gameStartText=resetText=gameOverText=instText=scoreText=bestText=null;floor=Math.floor;
main=function(){var h,k,a,l,m,e,g,n;l=function(a,c){var d;c.kill();score+=1;bestScore=score>bestScore?score:bestScore;scoreText.setText(score);d=bloods.getFirstDead();d.reset(c.body.x,c.body.y);d.play("blood",20,!1,!0);hurtSnd.play()};m=function(a,c){var d;c.kill();score+=5;bestScore=score>bestScore?score:bestScore;scoreText.setText(score);d=bloods.getFirstDead();d.reset(c.body.x,c.body.y);d.play("blood",20,!1,!0);hurtSnd.play()};h=function(){var b,c,d,f,e;dieRate=score/HARD;mashrooms.forEachAlive(function(b){b.x+
b.width<a.world.bounds.left&&b.kill()});mushrooms.forEachAlive(function(b){b.x+b.width<a.world.bounds.left&&b.kill()});smashroom.forEachAlive(function(b){b.x+b.width<a.world.bounds.left&&b.kill()});for(b=f=e=parseInt(10*Math.random())%4+8;0>=e?0>f:0<f;b=0>=e?++f:--f)d=Math.random()>dieRate?"mashroom":"smashroom",c="mashroom"===d?mashrooms:smashroom,b=0.9<Math.random()?mushrooms.create(a.world.width-120*(Math.random()-0.5),b*(35-5*(Math.random()-0.5)),"mushroom"):c.create(a.world.width-120*(Math.random()-
0.5),b*(35-5*(Math.random()-0.5)),d),b.anchor.setTo(0.5,0.5),b.body.velocity.x=1.5*-SPEED};k=function(){var b;gameStart||n();gameOver||(mario.body.velocity.y=-200,mario.body.gravity.y=0,b=a.add.tween(mario.body.velocity).to({y:-280},25,Phaser.Easing.Bounce.In,!0),b.onComplete.add(function(){return mario.body.gravity.y=GRAVITY}),flapSnd.play())};n=function(){gameStart=!0;gameStartText.renderable=!1;mashroomsTimer=a.time.events.loop(1/SPAWN_RATE,h);scoreText.setText(score);avoidText.renderable=!1};
e=function(){gameOver=!0;gameOverText.renderable=!0;resetText.renderable=!0;board.renderable=!0;bestText.renderable=!0;bestText.setText(bestScore);bestText.x=210;bestText.y=240;scoreText.x=210;scoreText.y=195;a.time.events.remove(mashroomsTimer);a.time.events.add(1E3,function(){return a.input.onTap.addOnce(function(){return g()})});fallSnd.play()};g=function(){gameOver=gameStart=!1;gameOverText.renderable=!1;resetText.renderable=!1;gameStartText.renderable=!0;board.renderable=!1;bestText.renderable=
!1;avoidText.renderable=!0;score=0;scoreText.setText("Flappy Mario");scoreText.x=a.world.width/2;scoreText.y=a.world.height/6;mashrooms.removeAll();mushrooms.removeAll();mario.reset(0.25*a.world.width,a.world.height/2.3)};return a=new Phaser.Game(WIDTH,HEIGHT,Phaser.CANVAS,"screen",{preload:function(){var b;b={image:{bg:"res/bg.png",mashroom:"res/mashroom.png",mushroom:"res/mushroom.png",smashroom:"res/smashroom.png",g:"res/g.png",mario:"res/mario.png",start:"res/start.png",reset:"res/reset.png",
over:"res/over.png",board:"res/board.png"},audio:{die:"res/sfx_die.mp3",hit:"res/sfx_hit.mp3",point:"res/sfx_point.mp3",flap:"res/sfx_wing.mp3"},spritesheet:{blood:["res/blood.png",64,64]}};Object.keys(b).forEach(function(c){Object.keys(b[c]).forEach(function(d){a.load[c].apply(a.load,[d].concat(b[c][d]))})})},create:function(){Phaser.Canvas.setSmoothingEnabled(a.context,!1);a.stage.scaleMode=Phaser.StageScaleMode.SHOW_ALL;a.stage.scale.setScreenSize(!0);a.world.width=WIDTH;a.world.height=HEIGHT;
bg=a.add.tileSprite(0,0,WIDTH,HEIGHT,"bg");ground=a.add.tileSprite(0,GROUND_Y,WIDTH,GROUND_HEIGHT,"g");mashrooms=a.add.group();mushrooms=a.add.group();smashroom=a.add.group();mario=a.add.sprite(0,0,"mario");mario.anchor.setTo(0.5,0.5);flapSnd=a.add.audio("flap");scoreSnd=a.add.audio("point");hurtSnd=a.add.audio("hit");fallSnd=a.add.audio("die");bloods=a.add.group();bloods.createMultiple(20,"blood");bloods.forEach(function(a){a.anchor.x=0.5;a.anchor.y=0.5;a.animations.add("blood")});board=a.add.sprite(a.world.width/
2,a.world.height/2.3,"board");board.anchor.setTo(0.5,0.5);board.scale.setTo(1,1);board.renderable=!1;scoreText=a.add.text(a.world.width/2,a.world.height/6,"",{font:'20px "sans"',fill:"#fff",stroke:"#111",strokeThickness:4,align:"center"});scoreText.anchor.setTo(0.5,0.5);bestText=a.add.text(a.world.width/2,a.world.height/6,"",{font:'20px "sans"',fill:"#fff",stroke:"#111",strokeThickness:4,align:"center"});bestText.anchor.setTo(0.5,0.5);bestText.renderable=!1;avoidText=a.add.text(a.world.width/2,a.world.height/
2.7,"",{font:'14px "sans"',fill:"#fff",stroke:"#111",strokeThickness:4,align:"center"});avoidText.anchor.setTo(0.5,0.5);avoidText.setText("Avoid this");gameStartText=a.add.sprite(a.world.width/2,a.world.height/2,"start");gameStartText.anchor.setTo(0.5,0.5);gameStartText.scale.setTo(1,1);gameOverText=a.add.sprite(a.world.width/2,a.world.height/4,"over");gameOverText.anchor.setTo(0.5,0.5);gameOverText.scale.setTo(1,1);gameOverText.renderable=!1;resetText=a.add.sprite(a.world.width/2,a.world.height/
1.5,"reset");resetText.anchor.setTo(0.5,0.5);resetText.scale.setTo(1,1);resetText.renderable=!1;a.input.onDown.add(k);g()},update:function(){gameStart&&(gameOver?mario.body.bottom>=GROUND_Y+3&&(mario.y=GROUND_Y-13,mario.body.velocity.y=0,mario.body.allowGravity=!1,mario.body.gravity.y=0):(a.physics.overlap(mario,smashroom,function(){e();return fallSnd.play()}),!gameOver&&mario.body.bottom>=GROUND_Y&&e(),a.physics.overlap(mario,mashrooms,l,null,this),a.physics.overlap(mario,mushrooms,m,null,this),
gameOver||(ground.tilePosition.x-=a.time.physicsElapsed*SPEED/2),gameOver||(bg.tilePosition.x-=a.time.physicsElapsed*SPEED)))},render:function(){}},!1)};main();